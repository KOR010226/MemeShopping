<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>迷因購物</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f9f9f9; }
    nav { background: #eee; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
    .products { display: flex; flex-wrap: wrap; padding: 1rem; gap: 1rem; }
    .product { border: 1px solid #ccc; padding: 1rem; width: 200px; background: white; border-radius: 4px; text-align: center; }
    .product img { width: 100%; height: 150px; object-fit: cover; margin-bottom: 0.5rem; }
    .cart { position: fixed; top: 1rem; right: 1rem; background: #fff7cc; padding: 1rem; border: 1px solid #ccc; border-radius: 4px; width: 250px; max-height: 400px; overflow-y: auto; display:none; }
    button { padding: 0.5rem 1rem; margin-top: 0.5rem; cursor: pointer; border: none; border-radius: 4px; }
    button:hover { opacity: 0.9; }
    .btn-add { background: #007bff; color: white; width: 100%; }
    .btn-checkout { background: #28a745; color: white; width: 100%; margin-top: 1rem; }
  </style>
</head>
<body>

  <nav>
    <h2>迷因購物</h2>
    <button id="cartBtn">購物車 (<span id="cartCount">0</span>)</button>
  </nav>

  <div class="products" id="products"></div>

  <div id="cart" class="cart">
    <h3>購物車內容</h3>
    <div id="cartItems"></div>
    <button id="checkoutBtn" class="btn-checkout">結帳</button>
  </div>

  <script>
    // 商品資料（之後可改成用 API 抓）
    const products = [
      {id:1, name:"迷因 T-shirt", price:399, image:"https://via.placeholder.com/200x150?text=Meme+T-shirt"},
      {id:2, name:"迷因 馬克杯", price:249, image:"https://via.placeholder.com/200x150?text=Meme+Cup"},
      {id:3, name:"迷因 貼紙", price:49, image:"https://via.placeholder.com/200x150?text=Meme+Sticker"},
      {id:4, name:"迷因 帽子", price:299, image:"https://via.placeholder.com/200x150?text=Meme+Hat"}
    ];

    // 購物車（使用 localStorage 保存）
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");

    const productsEl = document.getElementById("products");
    const cartEl = document.getElementById("cart");
    const cartItemsEl = document.getElementById("cartItems");
    const cartCountEl = document.getElementById("cartCount");

    function updateCartUI() {
        cartCountEl.textContent = cart.length;
        cartItemsEl.innerHTML = "";
        cart.forEach((item, index) => {
            const div = document.createElement("div");
            div.style.borderBottom = "1px solid #ccc";
            div.style.padding = "0.5rem 0";

            div.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span>${item.name} x ${item.quantity} - NT$${item.price}</span>
                <button onclick="removeFromCart(${index})" 
                        style="background:red;color:white;border:none;padding:4px 8px;border-radius:4px;">
                刪除
                </button>
            </div>
            `;

            cartItemsEl.appendChild(div);
        });
        }


    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartUI();
    }

    function addToCart(product) {
      const exist = cart.find(p => p.id === product.id);
      if(exist){
        exist.quantity += 1;
      } else {
        cart.push({...product, quantity:1});
      }
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartUI();
      alert("已加入購物車！");
    }

    // 渲染商品列表
    products.forEach(p => {
      const div = document.createElement("div");
      div.className = "product";
      div.innerHTML = `
        <img src="${p.image}" alt="${p.name}">
        <h3>${p.name}</h3>
        <p>NT$${p.price}</p>
        <button class="btn-add">加入購物車</button>
      `;
      div.querySelector("button").onclick = () => addToCart(p);
      productsEl.appendChild(div);
    });

    // 顯示/隱藏購物車
    document.getElementById("cartBtn").onclick = () => {
      cartEl.style.display = cartEl.style.display === "none" ? "block" : "none";
    };

    // 結帳流程
    document.getElementById("checkoutBtn").onclick = () => {
      if(cart.length===0){
        alert("購物車是空的！");
        return;
      }
      const total = cart.reduce((sum,i)=>sum+i.price*i.quantity,0);
      alert("結帳成功！總金額：NT$" + total);
      cart = [];
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartUI();
    };

    updateCartUI();
  </script>
</body>
</html>
